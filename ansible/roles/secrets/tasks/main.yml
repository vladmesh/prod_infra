---
- name: Create secrets directory
  file:
    path: /opt/secrets
    state: directory
    mode: '0700'
    owner: root
    group: root

- name: Store GitHub token
  copy:
    content: "{{ github_token }}"
    dest: /opt/secrets/github_token
    mode: '0600'
    owner: root
    group: root
  when: github_token is defined and github_token != ""
  no_log: true

- name: Login to GitHub Container Registry
  community.docker.docker_login:
    registry: ghcr.io
    username: "{{ ghcr_username }}"
    password: "{{ github_token }}"
  when: github_token is defined and github_token != "" and ghcr_username is defined
  no_log: true
