# Caddy configuration - auto-generated by Ansible
# Do not edit manually

{
    email vladmesh.dev@gmail.com
}

{% if services | length == 0 %}
# No services configured yet
:80 {
    respond "Server is running" 200
}
{% else %}
{% for service in services %}
# Service: {{ service.name }}
{{ service.domain }}{% if service.domains is defined %}{% for d in service.domains %}, {{ d }}{% endfor %}{% endif %} {
    encode zstd gzip

{% if service.routes is defined %}
{% for route in service.routes %}
    handle {{ route.path }} {
        reverse_proxy localhost:{{ route.port }}
    }

{% endfor %}
{% endif %}
    handle {
        reverse_proxy localhost:{{ service.port }}
    }

    # Security headers
    header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    header X-Content-Type-Options "nosniff"
    header Referrer-Policy "strict-origin-when-cross-origin"
}

{% endfor %}
{% endif %}
